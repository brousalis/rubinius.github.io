<!DOCTYPE html>
<html dir="ltr" lang="ru">
  <head>
    <title>Парсер Ruby - Rubinius</title>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content='ru' http-equiv='content-language'>
    <meta content='Rubinius is an implementation of the Ruby programming language. The Rubinius bytecode virtual machine is written in C++. The bytecode compiler is written in pure Ruby. The vast majority of the core library is also written in Ruby, with some supporting primitives that interact with the VM directly.' name='description'>
    <link href='/' rel='home'>
    <link href='/' rel='start'>
    <link href='/doc/ru/bytecode-compiler' rel='prev' title='Байткод-компилятор'>
    <link href='/doc/ru/bytecode-compiler/ast'         rel='next' title='AST'>
    
    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->

    <link rel="stylesheet" href="/assets/application-41e9626e04e15a1d2b0393f197784d83.css">
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" />

    <link href="/favicon.ico"                 rel="shortcut icon"    type="image/vnd.microsoft.icon" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="72x72"   />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="114x114" />
  </head>

  <body>
    <nav id="sidebar">
  <div class="sidebar-header">
    <a href="#" class="logo">Rubinius</a>
    <div role="search">
      <input type="text" name="q" placeholder="Search docs">
    </div>
  </div>

  <div class="sidebar-nav">
    <ul>
      <li><a href="/doc/en/what-is-rubinius/">What is Rubinius?</a> </li> 
      <li><a href="/doc/en/getting-started/">Getting Started</a>
        <ul>
          <li><a href="/doc/en/getting-started/requirements/">Requirements</a> </li>
          <li><a href="/doc/en/getting-started/building/">Building</a> </li>
          <li><a href="/doc/en/getting-started/running-rubinius/">Running Rubinius</a> </li>
          <li><a href="/doc/en/getting-started/troubleshooting/">Troubleshooting</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/contributing/">Contributing</a>
        <ul>
          <li><a href="/doc/en/contributing/communication/">Communication</a> </li>
          <li><a href="/doc/en/contributing/style-guide">Style Guide</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/ruby/">Ruby</a>
        <ul>
          <li><a href="/doc/en/ruby/scripts/">Scripts</a> </li>
          <li><a href="/doc/en/ruby/methods/">Methods</a> </li>
          <li><a href="/doc/en/ruby/constants/">Constants</a> </li>
          <li><a href="/doc/en/ruby/classes-and-modules/">Classes &amp; Modules</a> </li>
          <li><a href="/doc/en/ruby/blocks-and-procs/">Blocks &amp; Procs</a> </li>
          <li><a href="/doc/en/ruby/local-variables/">Local Variables</a> </li>
          <li><a href="/doc/en/ruby/instance-variables/">Instance Variables</a> </li>
          <li><a href="/doc/en/ruby/class-variables/">Class Variables</a> </li>
          <li><a href="/doc/en/ruby/global-variables/">Global Variables</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/specs/">Specs</a>
        <ul>
          <li><a href="/doc/en/specs/rubyspec/">RubySpec</a> </li> 
          <li><a href="/doc/en/specs/compiler/">Compiler Specs</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/build-system/">Build System</a> </li>
      <li><a href="/doc/en/bootstrapping/">Bootstrapping</a> </li>
      <li><a href="/doc/en/virtual-machine/">Virtual Machine</a> 
        <ul>
          <li><a href="/doc/en/virtual-machine/instructions/">Instructions</a> </li>
          <li><a href="/doc/en/virtual-machine/custom-dispatch-logic/">Custom Dispatch Logic</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/bytecode-compiler/">Bytecode Compiler</a>
        <ul>
          <li><a href="/doc/en/bytecode-compiler/parser/">Parser Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/ast/">AST</a> </li>
          <li><a href="/doc/en/bytecode-compiler/generator/">Generator Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/encoder/">Encoder Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/packager/">Packager Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/writer/">Writer Stage</a> </li>
          <li>Printers</li>
          <li><a href="/doc/en/bytecode-compiler/transformations/">Transformations</a> </li>
          <li><a href="/doc/en/bytecode-compiler/customization/">Customizing the Pipeline</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/jit/">JIT Compiler</a> </li>
      <li><a href="/doc/en/memory-system/">Memory system</a> 
        <ul>
          <li><a href="/doc/en/memory-system/object-layout/">Object layout</a> </li>
          <li><a href="/doc/en/memory-system/garbage-collector/">Garbage collector</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/systems/">Rubinius Systems</a>
        <ul>
          <li><a href="/doc/en/systems/primitives/">Primitives</a> </li>
          <li><a href="/doc/en/systems/ffi/">FFI</a> </li>
          <li><a href="/doc/en/systems/concurrency/">Concurrency</a> </li>
          <li><a href="/doc/en/systems/io/">IO</a> </li>
          <li><a href="/doc/en/systems/c-api/">C-API</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/tools/">Tools</a>
        <ul>
          <li><a href="/doc/en/tools/debugger/">Debugger</a> </li>
          <li><a href="/doc/en/tools/profiler/">Profiler</a> </li>
          <li><a href="/doc/en/tools/memory-analysis/">Memory Analysis</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/guides/">Guides</a>
        <ul>
          <li><a href="/doc/en/guides/migrating-from-mri-to-rubinius/">Migrating from MRI to Rubinius</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/how-to/">How-To</a>
        <ul>
          <li><a href="/doc/en/how-to/write-a-ticket/">Write a Ticket</a> </li>
          <li><a href="/doc/en/how-to/write-a-ruby-spec/">Write a Ruby Spec</a> </li>
          <li><a href="/doc/en/how-to/fix-a-failing-spec/">Fix a Failing Spec</a> </li>
          <li><a href="/doc/en/how-to/write-benchmarks/">Write Benchmarks</a> </li>
          <li><a href="/doc/en/how-to/write-a-blog-post/">Write a Blog Post</a> </li>
          <li><a href="/doc/en/how-to/write-documentation/">Write Documentation</a> </li>
          <li><a href="/doc/en/how-to/translate-documentation/">Translate Documentation</a> </li>
          <li><a href="/doc/en/how-to/commit-to-github/">Commit to Github</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/appendix-a-glossary/">Appendix A - Glossary</a> </li>
      <li><a href="/doc/en/appendix-b-reading-list/">Appendix B - Reading List</a> </li>
      <li><a href="/doc/en/index-of-terms/">Index of Terms</a> </li>
      <li><a href="/doc/en/frequently-asked-questions/">Frequently Asked Questions</a> </li>
    </ul>
  </div>

  <div class="sidebar-footer">
    <ul>
  
  
  
  <li><a href="/doc/de/bytecode-compiler/parser.html"
    
    >de</a></li>
  
  
  
  <li><a href="/doc/en/bytecode-compiler/parser.html"
    
    >en</a></li>
  
  
  
  <li><a href="/doc/es/bytecode-compiler/parser.html"
    
    >es</a></li>
  
  
  
  <li><a href="/doc/fr/bytecode-compiler/parser.html"
    
    >fr</a></li>
  
  
  
  <li><a href="/doc/it/bytecode-compiler/parser.html"
    
    >it</a></li>
  
  
  
  <li><a href="/doc/ja/bytecode-compiler/parser.html"
    
    >ja</a></li>
  
  
  
  <li><a href="/doc/pl/bytecode-compiler/parser.html"
    
    >pl</a></li>
  
  
  
  <li><a href="/doc/pt-br/bytecode-compiler/parser.html"
    
    >pt-br</a></li>
  
  
  
  <li><a href="/doc/ru/bytecode-compiler/parser.html"
    
    class="current"
    
    >ru</a></li>
  
</ul>

    <div class="social">
      <div class="icons">
        <a href="http://twitter.com/rubinius" class="twitter">@rubinius</a>
        <a href="http://github.com/rubinius" class="github">github</a>
      </div>
      <div class="version">
        <a href="https://github.com/rubinius/rubinius/releases/tag/v2.2.10">v2.2.10</a>
      </div>
    </div>
  </div>
</nav>


<div class="container documentation">
  <h2>Парсер Ruby</h2>

  

  
    <div class="review">
  <p>This topic has missing or partial documentation. Please help us improve it.</p>

  <p>
    See <a href="/doc/ru/how-to/write-documentation">How-To - Write Documentation</a>
  </p>
</div>

  

    <p>Первая стадия конвейера байткод-компиляции — Ruby-парсер. Парсер получает
файл или <code>String</code> с исходником и передает следующей стадии, генератору,
полученное AST (<em>Abstract Syntax Tree</em>, дерево абстрактного синтаксиса).</p>

<p>Сам парсер (он называется «Melbourne»), состоит из C-части, которая
представляет собой, в сущности, парсер MRI, и Ruby-части, которая отвечает за
создание Ruby-AST. C-часть общается с Ruby, вызывая специфический метод для
каждого узла дерева.</p>

<p>Каждый из таких методов имеет сигнатуру, содержащую всю информацию о текущем
обрабатываемом участке дерева. Например, если в Ruby-коде есть выражение <code>if</code>,
C-парсер вызовет <code>process_if</code> с номером строки, параметром, представляющим
условие, параметрами, представляющими тело <code>if</code>-выражения и секции <code>else</code>,
если таковая присутствует.</p>

<pre><code>def process_if(line, cond, body, else_body)
  AST::If.new line, cond, body, else_body
end
</code></pre>

<p>Все возможные методы <code>process_</code> можно посмотреть в исходниках Rubinius в файле
<code>lib/melbourne/processor.rb</code>.</p>

<p>Обратите внимание: во многих случаях парсер передает результат выполнения
одного <code>process_</code> как аргумент следующему. Например, в случае выражения <code>true
if 1</code> парсер сперва вызывает <code>process_lit(line 1)</code>, а затем
<code>process_true(line)</code>. Также вызывается <code>process_nil(line)</code>, потому что
парс-дерево изначально содержит <code>nil</code> для представления тела подвыражения
<code>else</code>. После этого вызывается <code>process_if</code> с номером строки и результатами
<code>process_lit</code>, <code>process_true</code> и <code>process_nil</code>.</p>

<p>Описанный процесс рекурсивно строит древовидную структуру, которую Rubinius
впоследствии передаст следующей стадии, Генератору.</p>

<h2 id="section">Файлы для справки</h2>

<ul>
  <li><code>lib/melbourne/processor.rb</code>: Ruby-интерфейс к C-парсеру. В этом файле
содержатся методы, начинающиеся с <code>process_</code>, которые и вызываются
C-парсером для каждого узла парс-дерева.</li>
  <li><code>lib/compiler/ast/*</code>: определения каждого из типов узлов AST, используемых в
melbourne.</li>
</ul>

<h2 id="section-1">Настройка</h2>

<p>Существует два способа настройки для этой стадии компиляции. Самый простой —
это настройка создания AST через <a href="/doc/ru/bytecode-compiler/transformations/">преобразования AST</a></p>

<p>Еще можно создать субкласс класса <code>Melbourne</code> и определить собственные
обработчики методов <code>process_</code>. Этот способ относится к «продвинутым» и к
настоящему времени не документирован.</p>


</div>


    <script src="/javascripts/jquery-1.3.2.js"></script>
    <script src="/javascripts/paging_keys.js"></script>
    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
