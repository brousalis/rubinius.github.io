<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <title>Packager Stage - Rubinius</title>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content='en' http-equiv='content-language'>
    <meta content='Rubinius is an implementation of the Ruby programming language. The Rubinius bytecode virtual machine is written in C++. The bytecode compiler is written in pure Ruby. The vast majority of the core library is also written in Ruby, with some supporting primitives that interact with the VM directly.' name='description'>
    <link href='/' rel='home'>
    <link href='/' rel='start'>
    <link href='/doc/en/bytecode-compiler/encoder' rel='prev' title='Encoder Stage'>
    <link href='/doc/en/bytecode-compiler/writer'         rel='next' title='Writer Stage'>
    
    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->

    <link rel="stylesheet" href="/assets/application-41e9626e04e15a1d2b0393f197784d83.css">
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" />

    <link href="/favicon.ico"                 rel="shortcut icon"    type="image/vnd.microsoft.icon" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="72x72"   />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="114x114" />
  </head>

  <body>
    <nav id="sidebar">
  <div class="sidebar-header">
    <a href="#" class="logo">Rubinius</a>
    <div role="search">
      <input type="text" name="q" placeholder="Search docs">
    </div>
  </div>

  <div class="sidebar-nav">
    <ul>
      <li><a href="/doc/en/what-is-rubinius/">What is Rubinius?</a> </li> 
      <li><a href="/doc/en/getting-started/">Getting Started</a>
        <ul>
          <li><a href="/doc/en/getting-started/requirements/">Requirements</a> </li>
          <li><a href="/doc/en/getting-started/building/">Building</a> </li>
          <li><a href="/doc/en/getting-started/running-rubinius/">Running Rubinius</a> </li>
          <li><a href="/doc/en/getting-started/troubleshooting/">Troubleshooting</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/contributing/">Contributing</a>
        <ul>
          <li><a href="/doc/en/contributing/communication/">Communication</a> </li>
          <li><a href="/doc/en/contributing/style-guide">Style Guide</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/ruby/">Ruby</a>
        <ul>
          <li><a href="/doc/en/ruby/scripts/">Scripts</a> </li>
          <li><a href="/doc/en/ruby/methods/">Methods</a> </li>
          <li><a href="/doc/en/ruby/constants/">Constants</a> </li>
          <li><a href="/doc/en/ruby/classes-and-modules/">Classes &amp; Modules</a> </li>
          <li><a href="/doc/en/ruby/blocks-and-procs/">Blocks &amp; Procs</a> </li>
          <li><a href="/doc/en/ruby/local-variables/">Local Variables</a> </li>
          <li><a href="/doc/en/ruby/instance-variables/">Instance Variables</a> </li>
          <li><a href="/doc/en/ruby/class-variables/">Class Variables</a> </li>
          <li><a href="/doc/en/ruby/global-variables/">Global Variables</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/specs/">Specs</a>
        <ul>
          <li><a href="/doc/en/specs/rubyspec/">RubySpec</a> </li> 
          <li><a href="/doc/en/specs/compiler/">Compiler Specs</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/build-system/">Build System</a> </li>
      <li><a href="/doc/en/bootstrapping/">Bootstrapping</a> </li>
      <li><a href="/doc/en/virtual-machine/">Virtual Machine</a> 
        <ul>
          <li><a href="/doc/en/virtual-machine/instructions/">Instructions</a> </li>
          <li><a href="/doc/en/virtual-machine/custom-dispatch-logic/">Custom Dispatch Logic</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/bytecode-compiler/">Bytecode Compiler</a>
        <ul>
          <li><a href="/doc/en/bytecode-compiler/parser/">Parser Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/ast/">AST</a> </li>
          <li><a href="/doc/en/bytecode-compiler/generator/">Generator Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/encoder/">Encoder Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/packager/">Packager Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/writer/">Writer Stage</a> </li>
          <li>Printers</li>
          <li><a href="/doc/en/bytecode-compiler/transformations/">Transformations</a> </li>
          <li><a href="/doc/en/bytecode-compiler/customization/">Customizing the Pipeline</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/jit/">JIT Compiler</a> </li>
      <li><a href="/doc/en/memory-system/">Memory system</a> 
        <ul>
          <li><a href="/doc/en/memory-system/object-layout/">Object layout</a> </li>
          <li><a href="/doc/en/memory-system/garbage-collector/">Garbage collector</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/systems/">Rubinius Systems</a>
        <ul>
          <li><a href="/doc/en/systems/primitives/">Primitives</a> </li>
          <li><a href="/doc/en/systems/ffi/">FFI</a> </li>
          <li><a href="/doc/en/systems/concurrency/">Concurrency</a> </li>
          <li><a href="/doc/en/systems/io/">IO</a> </li>
          <li><a href="/doc/en/systems/c-api/">C-API</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/tools/">Tools</a>
        <ul>
          <li><a href="/doc/en/tools/debugger/">Debugger</a> </li>
          <li><a href="/doc/en/tools/profiler/">Profiler</a> </li>
          <li><a href="/doc/en/tools/memory-analysis/">Memory Analysis</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/guides/">Guides</a>
        <ul>
          <li><a href="/doc/en/guides/migrating-from-mri-to-rubinius/">Migrating from MRI to Rubinius</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/how-to/">How-To</a>
        <ul>
          <li><a href="/doc/en/how-to/write-a-ticket/">Write a Ticket</a> </li>
          <li><a href="/doc/en/how-to/write-a-ruby-spec/">Write a Ruby Spec</a> </li>
          <li><a href="/doc/en/how-to/fix-a-failing-spec/">Fix a Failing Spec</a> </li>
          <li><a href="/doc/en/how-to/write-benchmarks/">Write Benchmarks</a> </li>
          <li><a href="/doc/en/how-to/write-a-blog-post/">Write a Blog Post</a> </li>
          <li><a href="/doc/en/how-to/write-documentation/">Write Documentation</a> </li>
          <li><a href="/doc/en/how-to/translate-documentation/">Translate Documentation</a> </li>
          <li><a href="/doc/en/how-to/commit-to-github/">Commit to Github</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/appendix-a-glossary/">Appendix A - Glossary</a> </li>
      <li><a href="/doc/en/appendix-b-reading-list/">Appendix B - Reading List</a> </li>
      <li><a href="/doc/en/index-of-terms/">Index of Terms</a> </li>
      <li><a href="/doc/en/frequently-asked-questions/">Frequently Asked Questions</a> </li>
    </ul>
  </div>

  <div class="sidebar-footer">
    <ul>
  
  
  
  <li><a href="/doc/de/bytecode-compiler/packager.html"
    
    >de</a></li>
  
  
  
  <li><a href="/doc/en/bytecode-compiler/packager.html"
    
    class="current"
    
    >en</a></li>
  
  
  
  <li><a href="/doc/es/bytecode-compiler/packager.html"
    
    >es</a></li>
  
  
  
  <li><a href="/doc/fr/bytecode-compiler/packager.html"
    
    >fr</a></li>
  
  
  
  <li><a href="/doc/it/bytecode-compiler/packager.html"
    
    >it</a></li>
  
  
  
  <li><a href="/doc/ja/bytecode-compiler/packager.html"
    
    >ja</a></li>
  
  
  
  <li><a href="/doc/pl/bytecode-compiler/packager.html"
    
    >pl</a></li>
  
  
  
  <li><a href="/doc/pt-br/bytecode-compiler/packager.html"
    
    >pt-br</a></li>
  
  
  
  <li><a href="/doc/ru/bytecode-compiler/packager.html"
    
    >ru</a></li>
  
</ul>

    <div class="social">
      <div class="icons">
        <a href="http://twitter.com/rubinius" class="twitter">@rubinius</a>
        <a href="http://github.com/rubinius" class="github">github</a>
      </div>
      <div class="version">
        <a href="https://github.com/rubinius/rubinius/releases/tag/v2.2.10">v2.2.10</a>
      </div>
    </div>
  </div>
</nav>


<div class="container documentation">
  <h2>Packager Stage</h2>

  

  

    <p>Once the Generator has been properly encoded in the Encoder stage,
Rubinius packages the bytecode up as a CompiledCode by creating a new
CompiledCode and setting a number of properties on it.</p>

<p>These properties are available on any CompiledCode. You can retrieve
the CompiledCode from a Ruby Method object by calling <code>executable</code> on
it.</p>

<ul>
  <li><em>iseq</em>: a Tuple containing the raw instruction sequence</li>
  <li><em>literals</em>: a Tuple contaning the literals used in the method.
Literals are used internally by Rubinius for values like Strings, and
are used by the <code>push_literal</code> and <code>set_literal</code> instructions.</li>
  <li><em>lines</em>: an Array containing the first instruction pointer for each
line represented by the bytecode</li>
  <li><em>required_args</em>: the number of arguments required by the method</li>
  <li><em>total_args</em>: the total number of arguments, including optional
arguments but not <code>*args</code></li>
  <li><em>splat</em>: the position of the splat argument, if any</li>
  <li><em>local_count</em>: the number of local variables, including parameters</li>
  <li><em>local_names</em>: a Tuple containing a list of all of the local variable
names. The first names will be the required, optional, splat and block
arguments, in that order.</li>
  <li><em>file</em>: the name of the file that will be used in stack traces and
other debugging information</li>
  <li><em>name</em>: the name of the method</li>
  <li><em>primitive</em>: the name of the primitive associated with this method, if
any</li>
  <li>metadata: it is possible to store additional structured metadata on a
compiled method. The compiled method has a piece of metadata named
<code>for_block</code> with the value <code>true</code> if the original generator was
created for a block.</li>
</ul>

<p>The Packager stage also makes sure that any child generators (such as
generators for blocks or methods) are also converted into compiled
methods. These child compiled methods are included in the literals tuple
of the parent compiled method.</p>

<p>Once the Generator has finished packaging itself as a CompiledCode, it
invokes the Writer stage, passing in the CompiledCode as its input.</p>

<h2 id="files-referenced">Files Referenced</h2>

<ul>
  <li><em>kernel/bootstrap/compiled_code.rb</em>: the basic implementation of
CompiledCode, mostly composed of wiring up primitives</li>
  <li><em>kernel/common/compiled_code.rb</em>: a more robust implementation of
CompiledCode, a combination of primitive methods and methods written
in Ruby</li>
  <li><em>vm/builtin/compiledcode.cpp</em>: the C++ implementation of the
CompiledCode primitives</li>
  <li><em>lib/compiler/generator.rb</em>: The implementation of the <code>package</code>
method, which populates the CompiledCode with information from the
Generator object.</li>
</ul>

<h2 id="customization">Customization</h2>

<p>In general, the <code>package</code> method is designed to populate the
CompiledCode with a group of variables. However, you could also use
the packager to populate another object with the same interface.
However, it would not necessarily be useful on its own, without
additional customizations later on.</p>


</div>


    <script src="/javascripts/jquery-1.3.2.js"></script>
    <script src="/javascripts/paging_keys.js"></script>
    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
