<!DOCTYPE html>
<html dir="ltr" lang="ja">
  <head>
    <title>Abstract Syntax Trees - Rubinius</title>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content='ja' http-equiv='content-language'>
    <meta content='Rubinius is an implementation of the Ruby programming language. The Rubinius bytecode virtual machine is written in C++. The bytecode compiler is written in pure Ruby. The vast majority of the core library is also written in Ruby, with some supporting primitives that interact with the VM directly.' name='description'>
    <link href='/' rel='home'>
    <link href='/' rel='start'>
    <link href='/doc/ja/bytecode-compiler/parser' rel='prev' title='Parser'>
    <link href='/doc/ja/bytecode-compiler/generator'         rel='next' title='Generator Stage'>
    
    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->

    <link rel="stylesheet" href="/assets/application-41e9626e04e15a1d2b0393f197784d83.css">
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" />

    <link href="/favicon.ico"                 rel="shortcut icon"    type="image/vnd.microsoft.icon" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="72x72"   />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="114x114" />
  </head>

  <body>
    <nav id="sidebar">
  <div class="sidebar-header">
    <a href="#" class="logo">Rubinius</a>
    <div role="search">
      <input type="text" name="q" placeholder="Search docs">
    </div>
  </div>

  <div class="sidebar-nav">
    <ul>
      <li><a href="/doc/en/what-is-rubinius/">What is Rubinius?</a> </li> 
      <li><a href="/doc/en/getting-started/">Getting Started</a>
        <ul>
          <li><a href="/doc/en/getting-started/requirements/">Requirements</a> </li>
          <li><a href="/doc/en/getting-started/building/">Building</a> </li>
          <li><a href="/doc/en/getting-started/running-rubinius/">Running Rubinius</a> </li>
          <li><a href="/doc/en/getting-started/troubleshooting/">Troubleshooting</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/contributing/">Contributing</a>
        <ul>
          <li><a href="/doc/en/contributing/communication/">Communication</a> </li>
          <li><a href="/doc/en/contributing/style-guide">Style Guide</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/ruby/">Ruby</a>
        <ul>
          <li><a href="/doc/en/ruby/scripts/">Scripts</a> </li>
          <li><a href="/doc/en/ruby/methods/">Methods</a> </li>
          <li><a href="/doc/en/ruby/constants/">Constants</a> </li>
          <li><a href="/doc/en/ruby/classes-and-modules/">Classes &amp; Modules</a> </li>
          <li><a href="/doc/en/ruby/blocks-and-procs/">Blocks &amp; Procs</a> </li>
          <li><a href="/doc/en/ruby/local-variables/">Local Variables</a> </li>
          <li><a href="/doc/en/ruby/instance-variables/">Instance Variables</a> </li>
          <li><a href="/doc/en/ruby/class-variables/">Class Variables</a> </li>
          <li><a href="/doc/en/ruby/global-variables/">Global Variables</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/specs/">Specs</a>
        <ul>
          <li><a href="/doc/en/specs/rubyspec/">RubySpec</a> </li> 
          <li><a href="/doc/en/specs/compiler/">Compiler Specs</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/build-system/">Build System</a> </li>
      <li><a href="/doc/en/bootstrapping/">Bootstrapping</a> </li>
      <li><a href="/doc/en/virtual-machine/">Virtual Machine</a> 
        <ul>
          <li><a href="/doc/en/virtual-machine/instructions/">Instructions</a> </li>
          <li><a href="/doc/en/virtual-machine/custom-dispatch-logic/">Custom Dispatch Logic</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/bytecode-compiler/">Bytecode Compiler</a>
        <ul>
          <li><a href="/doc/en/bytecode-compiler/parser/">Parser Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/ast/">AST</a> </li>
          <li><a href="/doc/en/bytecode-compiler/generator/">Generator Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/encoder/">Encoder Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/packager/">Packager Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/writer/">Writer Stage</a> </li>
          <li>Printers</li>
          <li><a href="/doc/en/bytecode-compiler/transformations/">Transformations</a> </li>
          <li><a href="/doc/en/bytecode-compiler/customization/">Customizing the Pipeline</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/jit/">JIT Compiler</a> </li>
      <li><a href="/doc/en/memory-system/">Memory system</a> 
        <ul>
          <li><a href="/doc/en/memory-system/object-layout/">Object layout</a> </li>
          <li><a href="/doc/en/memory-system/garbage-collector/">Garbage collector</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/systems/">Rubinius Systems</a>
        <ul>
          <li><a href="/doc/en/systems/primitives/">Primitives</a> </li>
          <li><a href="/doc/en/systems/ffi/">FFI</a> </li>
          <li><a href="/doc/en/systems/concurrency/">Concurrency</a> </li>
          <li><a href="/doc/en/systems/io/">IO</a> </li>
          <li><a href="/doc/en/systems/c-api/">C-API</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/tools/">Tools</a>
        <ul>
          <li><a href="/doc/en/tools/debugger/">Debugger</a> </li>
          <li><a href="/doc/en/tools/profiler/">Profiler</a> </li>
          <li><a href="/doc/en/tools/memory-analysis/">Memory Analysis</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/guides/">Guides</a>
        <ul>
          <li><a href="/doc/en/guides/migrating-from-mri-to-rubinius/">Migrating from MRI to Rubinius</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/how-to/">How-To</a>
        <ul>
          <li><a href="/doc/en/how-to/write-a-ticket/">Write a Ticket</a> </li>
          <li><a href="/doc/en/how-to/write-a-ruby-spec/">Write a Ruby Spec</a> </li>
          <li><a href="/doc/en/how-to/fix-a-failing-spec/">Fix a Failing Spec</a> </li>
          <li><a href="/doc/en/how-to/write-benchmarks/">Write Benchmarks</a> </li>
          <li><a href="/doc/en/how-to/write-a-blog-post/">Write a Blog Post</a> </li>
          <li><a href="/doc/en/how-to/write-documentation/">Write Documentation</a> </li>
          <li><a href="/doc/en/how-to/translate-documentation/">Translate Documentation</a> </li>
          <li><a href="/doc/en/how-to/commit-to-github/">Commit to Github</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/appendix-a-glossary/">Appendix A - Glossary</a> </li>
      <li><a href="/doc/en/appendix-b-reading-list/">Appendix B - Reading List</a> </li>
      <li><a href="/doc/en/index-of-terms/">Index of Terms</a> </li>
      <li><a href="/doc/en/frequently-asked-questions/">Frequently Asked Questions</a> </li>
    </ul>
  </div>

  <div class="sidebar-footer">
    <ul>
  
  
  
  <li><a href="/doc/de/bytecode-compiler/ast.html"
    
    >de</a></li>
  
  
  
  <li><a href="/doc/en/bytecode-compiler/ast.html"
    
    >en</a></li>
  
  
  
  <li><a href="/doc/es/bytecode-compiler/ast.html"
    
    >es</a></li>
  
  
  
  <li><a href="/doc/fr/bytecode-compiler/ast.html"
    
    >fr</a></li>
  
  
  
  <li><a href="/doc/it/bytecode-compiler/ast.html"
    
    >it</a></li>
  
  
  
  <li><a href="/doc/ja/bytecode-compiler/ast.html"
    
    class="current"
    
    >ja</a></li>
  
  
  
  <li><a href="/doc/pl/bytecode-compiler/ast.html"
    
    >pl</a></li>
  
  
  
  <li><a href="/doc/pt-br/bytecode-compiler/ast.html"
    
    >pt-br</a></li>
  
  
  
  <li><a href="/doc/ru/bytecode-compiler/ast.html"
    
    >ru</a></li>
  
</ul>

    <div class="social">
      <div class="icons">
        <a href="http://twitter.com/rubinius" class="twitter">@rubinius</a>
        <a href="http://github.com/rubinius" class="github">github</a>
      </div>
      <div class="version">
        <a href="https://github.com/rubinius/rubinius/releases/tag/v2.2.10">v2.2.10</a>
      </div>
    </div>
  </div>
</nav>


<div class="container documentation">
  <h2>Abstract Syntax Trees</h2>

  

  
    <div class="review">
  <p>This topic has missing or partial documentation. Please help us improve it.</p>

  <p>
    See <a href="/doc/ja/how-to/write-documentation">How-To - Write Documentation</a>
  </p>
</div>

  

    <p>パーサが<code>process_*</code>メソッドでの処理を終えると、抽象構文木が出来上がります。
この構文木は、パースされたコードの構文構造を抽象的に表現します。
各ノードがソースコード内の１つの構造を表しています。
このツリーは <em>lib/compiler/ast/</em> ディレクトリ内で定義されているクラス群の
インスタンスによって構成されています。
各クラスは<code>Rubinius::AST::Node</code>クラスを継承しています。
この<code>Node</code>クラスにはサブクラスから利用されるいくつかのメソッド
（例えば、デバッグ用に行番号を記録する pos(g)、など）
が定義されています。</p>

<p>ASTクラスには通常、少なくとも以下の３つのメソッドが定義されています：</p>

<ul>
  <li>initialize(line, args) - 前のステージで、さまざまな <code>process_*</code> メソッドから呼ばれます。</li>
  <li>bytecode(g) - 次のステージのGeneratorが使います。</li>
  <li>to_sexp - ASTノードをシンボリックな表現(S式)にします。</li>
</ul>

<p>作成されたASTを確認する一番簡単な方法は
<code>to_ast</code>メソッドをコードの文字列に対して呼ぶことです：</p>

<pre><code>irb(main):002:0&gt; "a = 1".to_ast
=&gt; #&lt;Rubinius::AST::LocalVariableAssignment:0xf70
   @value=#&lt;Rubinius::AST::FixnumLiteral:0xf74 @value=1 @line=1&gt;
   @name=:a @variable=nil @line=1&gt;
</code></pre>

<p>もしくは、コードをコンパイルするときに -A オプションを指定します：</p>

<pre><code>rbx compile -A -e "def hello;end"
Script
  @name: __script__
  @file: "(snippet)"
  @body: \
  Define
    @name: hello
    @line: 1
    @arguments: \
    FormalArguments
      @defaults: nil
      @names: \
      @block_arg: nil
      @optional: \
      @splat: nil
      @line: 1
      @required: \
    @body: \
    Block
      @line: 1
      @array: \
        NilLiteral
          @line: 1
</code></pre>

<p>同様に、<code>to_sexp</code>メソッドで構文木のS式の表現を得ることもできます：</p>

<pre><code>irb(main):002:0&gt; "a = 1".to_sexp
=&gt; [:lasgn, :a, [:lit, 1]]
</code></pre>

<p>もしくはコンパイル時に -S オプションを使います：</p>

<pre><code>rbx compile -S -e "def hello;end"
[:script, [:defn, :hello, [:args], [:scope, [:block, [:nil]]]]]
</code></pre>

<p>抽象構文木は、ノードが他のノードを持つ、ネストした構造です。
例えば、上の例にある <code>hello</code> メソッドの定義の場合、
その構文木は<code>Script</code>ノードで、<code>@body</code>に<code>Define</code>ノードを持ちます。
この<code>Define</code>ノードの<code>@arguments</code>には<code>FormalAguments</code>ノードが、
<code>@body</code>には<code>Block</code>ノードが入っています。
そしてこの <code>Block</code>ノードの<code>@array</code>には<code>NilLiteral</code>だけが入っています。
この<code>NilLiteral</code>ノードは葉（リーフノード）で、他のノードを持ちません。</p>

<p>以下の <code>if</code>式と：</p>

<pre><code>rbx compile -S -e ":foo if :bar"
[:script, [:if, [:lit, :bar], [:lit, :foo], nil]]
</code></pre>

<p>違う方式で書かれている同等のif式が：</p>

<pre><code>rbx compile -S -e "if :bar then :foo; end"
[:script, [:if, [:lit, :bar], [:lit, :foo], nil]]
</code></pre>

<p>全く同じ構文木になることに注意して下さい。
実際のシンタックスの全てを正確に表現するわけではないので、
「抽象」構文木と呼ばれています。</p>

<h2 id="section">参照されているファイル</h2>

<ul>
  <li><em>lib/compiler/ast/</em>: 全てのASTクラスはこのディレクトリ以下に定義されています。</li>
</ul>

<h2 id="section-1">カスタマイズする</h2>

<p>コンパイル処理のこの段階をカスタマイズするには２つの方法があります。
一番簡単な方法はASTの生成を
<a href="/doc/en/bytecode-compiler/transformations/">AST Transforms</a>
を使ってカスタマイズすることです。</p>

<p>Melbourneパーサのサブクラスを定義し、
<code>process_</code>メソッドを再定義することもできます。
しかし、この方法は上級者向けで、まだ十分に実証されていません。</p>


</div>


    <script src="/javascripts/jquery-1.3.2.js"></script>
    <script src="/javascripts/paging_keys.js"></script>
    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
