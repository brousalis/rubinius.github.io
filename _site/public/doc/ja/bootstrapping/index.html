<!DOCTYPE html>
<html dir="ltr" lang="ja">
  <head>
    <title>Bootstrapping - Rubinius</title>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content='ja' http-equiv='content-language'>
    <meta content='Rubinius is an implementation of the Ruby programming language. The Rubinius bytecode virtual machine is written in C++. The bytecode compiler is written in pure Ruby. The vast majority of the core library is also written in Ruby, with some supporting primitives that interact with the VM directly.' name='description'>
    <link href='/' rel='home'>
    <link href='/' rel='start'>
    <link href='/doc/ja/build-system' rel='prev' title='Build System'>
    <link href='/doc/ja/virtual-machine'         rel='next' title='Virtual Machine'>
    
    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->

    <link href="/stylesheets/application.css" media="screen" rel="stylesheet" />
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" />

    <link href="/favicon.ico"                 rel="shortcut icon"    type="image/vnd.microsoft.icon" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="72x72"   />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="114x114" />
  </head>

  <body>
    <nav id="sidebar">
  <div class="sidebar-header">
    <a href="#" class="logo">Rubinius</a>
    <div role="search">
      <input type="text" name="q" placeholder="Search docs">
    </div>
  </div>

  <div class="sidebar-nav">
    <ul>
      <li><a href="/doc/en/what-is-rubinius/">What is Rubinius?</a> </li> 
      <li><a href="/doc/en/getting-started/">Getting Started</a>
        <ul>
          <li><a href="/doc/en/getting-started/requirements/">Requirements</a> </li>
          <li><a href="/doc/en/getting-started/building/">Building</a> </li>
          <li><a href="/doc/en/getting-started/running-rubinius/">Running Rubinius</a> </li>
          <li><a href="/doc/en/getting-started/troubleshooting/">Troubleshooting</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/contributing/">Contributing</a>
        <ul>
          <li><a href="/doc/en/contributing/communication/">Communication</a> </li>
          <li><a href="/doc/en/contributing/style-guide">Style Guide</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/ruby/">Ruby</a>
        <ul>
          <li><a href="/doc/en/ruby/scripts/">Scripts</a> </li>
          <li><a href="/doc/en/ruby/methods/">Methods</a> </li>
          <li><a href="/doc/en/ruby/constants/">Constants</a> </li>
          <li><a href="/doc/en/ruby/classes-and-modules/">Classes &amp; Modules</a> </li>
          <li><a href="/doc/en/ruby/blocks-and-procs/">Blocks &amp; Procs</a> </li>
          <li><a href="/doc/en/ruby/local-variables/">Local Variables</a> </li>
          <li><a href="/doc/en/ruby/instance-variables/">Instance Variables</a> </li>
          <li><a href="/doc/en/ruby/class-variables/">Class Variables</a> </li>
          <li><a href="/doc/en/ruby/global-variables/">Global Variables</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/specs/">Specs</a>
        <ul>
          <li><a href="/doc/en/specs/rubyspec/">RubySpec</a> </li> 
          <li><a href="/doc/en/specs/compiler/">Compiler Specs</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/build-system/">Build System</a> </li>
      <li><a href="/doc/en/bootstrapping/">Bootstrapping</a> </li>
      <li><a href="/doc/en/virtual-machine/">Virtual Machine</a> 
        <ul>
          <li><a href="/doc/en/virtual-machine/instructions/">Instructions</a> </li>
          <li><a href="/doc/en/virtual-machine/custom-dispatch-logic/">Custom Dispatch Logic</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/bytecode-compiler/">Bytecode Compiler</a>
        <ul>
          <li><a href="/doc/en/bytecode-compiler/parser/">Parser Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/ast/">AST</a> </li>
          <li><a href="/doc/en/bytecode-compiler/generator/">Generator Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/encoder/">Encoder Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/packager/">Packager Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/writer/">Writer Stage</a> </li>
          <li>Printers</li>
          <li><a href="/doc/en/bytecode-compiler/transformations/">Transformations</a> </li>
          <li><a href="/doc/en/bytecode-compiler/customization/">Customizing the Pipeline</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/jit/">JIT Compiler</a> </li>
      <li><a href="/doc/en/memory-system/">Memory system</a> 
        <ul>
          <li><a href="/doc/en/memory-system/object-layout/">Object layout</a> </li>
          <li><a href="/doc/en/memory-system/garbage-collector/">Garbage collector</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/systems/">Rubinius Systems</a>
        <ul>
          <li><a href="/doc/en/systems/primitives/">Primitives</a> </li>
          <li><a href="/doc/en/systems/ffi/">FFI</a> </li>
          <li><a href="/doc/en/systems/concurrency/">Concurrency</a> </li>
          <li><a href="/doc/en/systems/io/">IO</a> </li>
          <li><a href="/doc/en/systems/c-api/">C-API</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/tools/">Tools</a>
        <ul>
          <li><a href="/doc/en/tools/debugger/">Debugger</a> </li>
          <li><a href="/doc/en/tools/profiler/">Profiler</a> </li>
          <li><a href="/doc/en/tools/memory-analysis/">Memory Analysis</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/guides/">Guides</a>
        <ul>
          <li><a href="/doc/en/guides/migrating-from-mri-to-rubinius/">Migrating from MRI to Rubinius</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/how-to/">How-To</a>
        <ul>
          <li><a href="/doc/en/how-to/write-a-ticket/">Write a Ticket</a> </li>
          <li><a href="/doc/en/how-to/write-a-ruby-spec/">Write a Ruby Spec</a> </li>
          <li><a href="/doc/en/how-to/fix-a-failing-spec/">Fix a Failing Spec</a> </li>
          <li><a href="/doc/en/how-to/write-benchmarks/">Write Benchmarks</a> </li>
          <li><a href="/doc/en/how-to/write-a-blog-post/">Write a Blog Post</a> </li>
          <li><a href="/doc/en/how-to/write-documentation/">Write Documentation</a> </li>
          <li><a href="/doc/en/how-to/translate-documentation/">Translate Documentation</a> </li>
          <li><a href="/doc/en/how-to/commit-to-github/">Commit to Github</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/appendix-a-glossary/">Appendix A - Glossary</a> </li>
      <li><a href="/doc/en/appendix-b-reading-list/">Appendix B - Reading List</a> </li>
      <li><a href="/doc/en/index-of-terms/">Index of Terms</a> </li>
      <li><a href="/doc/en/frequently-asked-questions/">Frequently Asked Questions</a> </li>
    </ul>
  </div>

  <div class="sidebar-footer">
    <ul>
  
  
  
  <li><a href="/doc/de/bootstrapping/"
    
    >de</a></li>
  
  
  
  <li><a href="/doc/en/bootstrapping/"
    
    >en</a></li>
  
  
  
  <li><a href="/doc/es/bootstrapping/"
    
    >es</a></li>
  
  
  
  <li><a href="/doc/fr/bootstrapping/"
    
    >fr</a></li>
  
  
  
  <li><a href="/doc/it/bootstrapping/"
    
    >it</a></li>
  
  
  
  <li><a href="/doc/ja/bootstrapping/"
    
    class="current"
    
    >ja</a></li>
  
  
  
  <li><a href="/doc/pl/bootstrapping/"
    
    >pl</a></li>
  
  
  
  <li><a href="/doc/pt-br/bootstrapping/"
    
    >pt-br</a></li>
  
  
  
  <li><a href="/doc/ru/bootstrapping/"
    
    >ru</a></li>
  
</ul>

    <div class="social">
      <div class="icons">
        <a href="http://twitter.com/rubinius" class="twitter">@rubinius</a>
        <a href="http://github.com/rubinius" class="github">github</a>
      </div>
      <div class="version">
        <a href="https://github.com/rubinius/rubinius/releases/tag/v2.2.10">v2.2.10</a>
      </div>
    </div>
  </div>
</nav>


<div class="container documentation">
  <h2>Bootstrapping</h2>

  
    <div class="review">
  <p>This page was machine translated. Please help us improve it.</p>

  <p>
    See <a href="/doc/ja/how-to/translate-documentation">How-To - Translate Documentation</a>
  </p>
</div>

  

  

    <p>Bootstrapping is the process of building up functionality of the system until
all Ruby code can be executed. There are seven stages to the bootstrap process:</p>

<ol>
<li><p> VM: The virtual machine is able to load and execute bytecode, send
 messages (i.e. look up and execute methods), and all primitive functions
 are available, but not yet hooked up as Ruby methods.</p>

<p> The Class class has to be manually set up this early in the process by
 setting its class to be itself and its superclass to be Module. In
 addition to Class and Module, a couple of other base classes are created
 here including Object, Tuple, LookupTable, and MethodTable.</p>

<p> Now that classes can be defined, 35 or so built in classes are told to
 initialize themselves, symbols for top level methods (:object_id, :call,
 :protected, etc) are created, basic exceptions are defined, and
 primitives are registered. Finally IO gets hooked up. Also at this stage,
 several fundamental Ruby methods are bound to primitives.</p>

<p> At this point there is enough defined behavior to begin to load up the
 rest of the runtime kernel which is all defined in ruby. This has to be
 done in several passes as the language grows.</p></li>
<li><p> alpha: This starts the loading of Ruby code. The ability to open classes
 and modules and define methods exists. The minimum functionality to
 support the following methods is implemented in kernel/alpha.rb:</p>

<p>   attr_reader :sym
   attr_writer :sym
   attr_accessor :sym
   private :sym
   protected :sym
   module_function :sym
   include mod</p>

<p> Also, it is possible to raise exceptions and cause the running process to
 exit. This stage lays the foundation for the next two stages.</p></li>
<li><p> bootstrap: This stage continues to add the minimum functionality to
 support loading platform and common. The primitive functions are added
 for most of the kernel classes.</p></li>
<li><p> platform: The FFI (foreign function interface) system is implemented and
 Ruby method interfaces to platform-specific functions are created.  Once
 this is set up, platform specific things such as pointers, file access,
 math, and POSIX commands are attached.</p></li>
<li><p> common: The vast majority of the Ruby core library classes are
 implemented. The Ruby core classes are kept as implementation-neutral as
 possible. Also, most of the functionality for Rubinius specific classes
 is added.</p></li>
<li><p> delta: Final versions of methods like #attr_reader, etc. are added. Also,
 implementation-specific versions of methods that override the versions
 provided in common are added.</p></li>
<li><p> loader: The compiled version of kernel/loader.rb is run.</p>

<p> The final stage sets up the life cycle of a ruby process. It starts by
 connecting the VM to the system, sets up load paths, and reads
 customization scripts from the home directory. It traps signals, and
 processes command line arguments.</p>

<p> After that, it either runs the script passed to it from the command line
 or boots up the interactive ruby shell. When that finishes, it runs any
 at_exit blocks that had been registered, finalizes all objects, and
 exits.</p></li>
</ol>


<h2>Load Order</h2>

<p>The files in the kernel directories bootstrap, platform, common, and delta,
implement the respective bootstrapping stages above. The order in
which these directories are loaded is specified in runtime/index.</p>

<p>When an rbc file is loaded, code at the script level and in class or module
bodies is executed. For instance, when loading</p>

<pre><code>class SomeClass
  attr_accessor :value
end
</code></pre>

<p>the call to #attr_accessor will be run. This requires that any code called in
script, class, or module bodies be loaded before the file that calls the code.
The kernel/alpha.rb defines most of the code that will be needed at the script
or module level. However, other load order dependencies exist between some of
the platform, common, delta, and compiler files.</p>

<p>These load order dependencies are addressed by the load_order.txt file located
in each of the kernel/** directories. If you modify code that adds a load
order dependency, you must edit the load_order.txt files to place the depended
on file above the file that depends on it. Also, if you add a new file to one
of the kernel directories, you must add the file name to the load_order.txt
file in that directory. These files are copied to the appropriate runtime/**
directories during build. During each of the bootstrap stages above, the VM
loads the files listed in load_order.txt in order.</p>


</div>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="/javascripts/jquery-1.3.2.js"></script>
    <script src="/javascripts/paging_keys.js"></script>
    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
