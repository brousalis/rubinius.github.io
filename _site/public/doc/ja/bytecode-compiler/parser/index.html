<!DOCTYPE html>
<html dir="ltr" lang="ja">
  <head>
    <title>Ruby Parser - Rubinius</title>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content='ja' http-equiv='content-language'>
    <meta content='Rubinius is an implementation of the Ruby programming language. The Rubinius bytecode virtual machine is written in C++. The bytecode compiler is written in pure Ruby. The vast majority of the core library is also written in Ruby, with some supporting primitives that interact with the VM directly.' name='description'>
    <link href='/' rel='home'>
    <link href='/' rel='start'>
    <link href='/doc/ja/bytecode-compiler' rel='prev' title='Bytecode Compiler'>
    <link href='/doc/ja/bytecode-compiler/ast'         rel='next' title='AST'>
    
    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->

    <link href="/stylesheets/application.css" media="screen" rel="stylesheet" />
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" />

    <link href="/favicon.ico"                 rel="shortcut icon"    type="image/vnd.microsoft.icon" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="72x72"   />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="114x114" />
  </head>

  <body>
    <nav id="sidebar">
  <div class="sidebar-header">
    <a href="#" class="logo">Rubinius</a>
    <div role="search">
      <input type="text" name="q" placeholder="Search docs">
    </div>
  </div>

  <div class="sidebar-nav">
    <ul>
      <li><a href="/doc/en/what-is-rubinius/">What is Rubinius?</a> </li> 
      <li><a href="/doc/en/getting-started/">Getting Started</a>
        <ul>
          <li><a href="/doc/en/getting-started/requirements/">Requirements</a> </li>
          <li><a href="/doc/en/getting-started/building/">Building</a> </li>
          <li><a href="/doc/en/getting-started/running-rubinius/">Running Rubinius</a> </li>
          <li><a href="/doc/en/getting-started/troubleshooting/">Troubleshooting</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/contributing/">Contributing</a>
        <ul>
          <li><a href="/doc/en/contributing/communication/">Communication</a> </li>
          <li><a href="/doc/en/contributing/style-guide">Style Guide</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/ruby/">Ruby</a>
        <ul>
          <li><a href="/doc/en/ruby/scripts/">Scripts</a> </li>
          <li><a href="/doc/en/ruby/methods/">Methods</a> </li>
          <li><a href="/doc/en/ruby/constants/">Constants</a> </li>
          <li><a href="/doc/en/ruby/classes-and-modules/">Classes &amp; Modules</a> </li>
          <li><a href="/doc/en/ruby/blocks-and-procs/">Blocks &amp; Procs</a> </li>
          <li><a href="/doc/en/ruby/local-variables/">Local Variables</a> </li>
          <li><a href="/doc/en/ruby/instance-variables/">Instance Variables</a> </li>
          <li><a href="/doc/en/ruby/class-variables/">Class Variables</a> </li>
          <li><a href="/doc/en/ruby/global-variables/">Global Variables</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/specs/">Specs</a>
        <ul>
          <li><a href="/doc/en/specs/rubyspec/">RubySpec</a> </li> 
          <li><a href="/doc/en/specs/compiler/">Compiler Specs</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/build-system/">Build System</a> </li>
      <li><a href="/doc/en/bootstrapping/">Bootstrapping</a> </li>
      <li><a href="/doc/en/virtual-machine/">Virtual Machine</a> 
        <ul>
          <li><a href="/doc/en/virtual-machine/instructions/">Instructions</a> </li>
          <li><a href="/doc/en/virtual-machine/custom-dispatch-logic/">Custom Dispatch Logic</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/bytecode-compiler/">Bytecode Compiler</a>
        <ul>
          <li><a href="/doc/en/bytecode-compiler/parser/">Parser Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/ast/">AST</a> </li>
          <li><a href="/doc/en/bytecode-compiler/generator/">Generator Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/encoder/">Encoder Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/packager/">Packager Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/writer/">Writer Stage</a> </li>
          <li>Printers</li>
          <li><a href="/doc/en/bytecode-compiler/transformations/">Transformations</a> </li>
          <li><a href="/doc/en/bytecode-compiler/customization/">Customizing the Pipeline</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/jit/">JIT Compiler</a> </li>
      <li><a href="/doc/en/memory-system/">Memory system</a> 
        <ul>
          <li><a href="/doc/en/memory-system/object-layout/">Object layout</a> </li>
          <li><a href="/doc/en/memory-system/garbage-collector/">Garbage collector</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/systems/">Rubinius Systems</a>
        <ul>
          <li><a href="/doc/en/systems/primitives/">Primitives</a> </li>
          <li><a href="/doc/en/systems/ffi/">FFI</a> </li>
          <li><a href="/doc/en/systems/concurrency/">Concurrency</a> </li>
          <li><a href="/doc/en/systems/io/">IO</a> </li>
          <li><a href="/doc/en/systems/c-api/">C-API</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/tools/">Tools</a>
        <ul>
          <li><a href="/doc/en/tools/debugger/">Debugger</a> </li>
          <li><a href="/doc/en/tools/profiler/">Profiler</a> </li>
          <li><a href="/doc/en/tools/memory-analysis/">Memory Analysis</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/guides/">Guides</a>
        <ul>
          <li><a href="/doc/en/guides/migrating-from-mri-to-rubinius/">Migrating from MRI to Rubinius</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/how-to/">How-To</a>
        <ul>
          <li><a href="/doc/en/how-to/write-a-ticket/">Write a Ticket</a> </li>
          <li><a href="/doc/en/how-to/write-a-ruby-spec/">Write a Ruby Spec</a> </li>
          <li><a href="/doc/en/how-to/fix-a-failing-spec/">Fix a Failing Spec</a> </li>
          <li><a href="/doc/en/how-to/write-benchmarks/">Write Benchmarks</a> </li>
          <li><a href="/doc/en/how-to/write-a-blog-post/">Write a Blog Post</a> </li>
          <li><a href="/doc/en/how-to/write-documentation/">Write Documentation</a> </li>
          <li><a href="/doc/en/how-to/translate-documentation/">Translate Documentation</a> </li>
          <li><a href="/doc/en/how-to/commit-to-github/">Commit to Github</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/appendix-a-glossary/">Appendix A - Glossary</a> </li>
      <li><a href="/doc/en/appendix-b-reading-list/">Appendix B - Reading List</a> </li>
      <li><a href="/doc/en/index-of-terms/">Index of Terms</a> </li>
      <li><a href="/doc/en/frequently-asked-questions/">Frequently Asked Questions</a> </li>
    </ul>
  </div>

  <div class="sidebar-footer">
    <ul>
  
  
  
  <li><a href="/doc/de/bytecode-compiler/parser/"
    
    >de</a></li>
  
  
  
  <li><a href="/doc/en/bytecode-compiler/parser/"
    
    >en</a></li>
  
  
  
  <li><a href="/doc/es/bytecode-compiler/parser/"
    
    >es</a></li>
  
  
  
  <li><a href="/doc/fr/bytecode-compiler/parser/"
    
    >fr</a></li>
  
  
  
  <li><a href="/doc/it/bytecode-compiler/parser/"
    
    >it</a></li>
  
  
  
  <li><a href="/doc/ja/bytecode-compiler/parser/"
    
    class="current"
    
    >ja</a></li>
  
  
  
  <li><a href="/doc/pl/bytecode-compiler/parser/"
    
    >pl</a></li>
  
  
  
  <li><a href="/doc/pt-br/bytecode-compiler/parser/"
    
    >pt-br</a></li>
  
  
  
  <li><a href="/doc/ru/bytecode-compiler/parser/"
    
    >ru</a></li>
  
</ul>

    <div class="social">
      <div class="icons">
        <a href="http://twitter.com/rubinius" class="twitter">@rubinius</a>
        <a href="http://github.com/rubinius" class="github">github</a>
      </div>
      <div class="version">
        <a href="https://github.com/rubinius/rubinius/releases/tag/v2.2.10">v2.2.10</a>
      </div>
    </div>
  </div>
</nav>


<div class="container documentation">
  <h2>Ruby Parser</h2>

  

  
    <div class="review">
  <p>This topic has missing or partial documentation. Please help us improve it.</p>

  <p>
    See <a href="/doc/ja/how-to/write-documentation">How-To - Write Documentation</a>
  </p>
</div>

  

    <p>コンパイル処理のパイプラインの最初のステージはRubyパーサです。
Rubyパーサはコードの文字列またはファイルを入力として受け取り、
ASTを次のステージであるジェネレータに渡します。</p>

<p>パーサ（Melbourne）にはCで書かれたパートとRubyで書かれたパートがあり、
前者は基本的にはMRIのパーサで、後者はRubyのASTの生成を担当しています。
Cのパーサはパースツリーの各ノードについてメソッドを呼ぶことで
Rubyとコミュニケーションをとります。</p>

<p>各メソッドは処理対象となる部分木について、その特徴となる全ての情報を受け取ります。
例えば、対象のRubyコードに<code>if</code>文がある場合、
Cパーサは行番号、条件を表す値、if文の本体を表す値、もしあればelse節を表す値、
を引数として、<code>process_if</code>を呼びます。</p>

<pre><code>def process_if(line, cond, body, else_body)
  AST::If.new line, cond, body, else_body
end
</code></pre>

<p>Rubiniusのソースコード内の<code>lib/melbourne/processor.rb</code>を見ると、
全ての起こりうる<code>process_</code>呼び出しが確認できます。</p>

<p>多くの場合、パーサは<code>process_</code>メソッドに
その一つ前に呼び出された<code>process_</code>メソッドの結果を渡します。
例えば <code>true if 1</code> というコードでは、パーサはまず <code>process_lit(line,1)</code> と
<code>process_true(line)</code> を実行します。
加えて、この場合元のパースツリーは<code>else</code>の本体として<code>nil</code>を持っているので、
 <code>process_nil(line)</code>も実行されます。
その後、<code>process_if</code>を、行番号、<code>process_lit</code>の結果、<code>process_true</code>の結果、
<code>process_nil</code>の結果を引数にして呼び出します。</p>

<p>このような処理が再帰的にツリー構造を構築し、
Rubiniusはそれを次の段階であるジェネレータステージに渡します。</p>

<h2>参照されているファイル</h2>

<ul>
<li><p><em>lib/melbourne/processor.rb</em>: CパーサのRubyインターフェースです。
このファイルには <code>process_</code> で始まる名前のメソッド郡が定義されていて、
これらのメソッドはCパーサがのCのパースツリーの各ノードについて呼び出します。</p></li>
<li><p><em>lib/compiler/ast/*</em>: Melbourneが使う各ASTノードの定義があります。</p></li>
</ul>


<h2>カスタマイズする</h2>

<p>コンパイル処理のこのステージをカスタマイズするには２つの方法があります。
ASTの生成をカスタマイズする一番簡単な方法は、
<a href="/doc/en/bytecode-compiler/transformations/">AST Transforms</a>を使う方法です。</p>

<p>Melbourneのサブクラスを定義し、<code>process_</code>メソッドを好きなように定義する方法も
あります。こちらは上級者向けのまだ十分に実証されていない方法です。</p>


</div>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="/javascripts/jquery-1.3.2.js"></script>
    <script src="/javascripts/paging_keys.js"></script>
    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
