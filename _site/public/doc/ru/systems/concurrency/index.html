<!DOCTYPE html>
<html dir="ltr" lang="ru">
  <head>
    <title>Параллелизм - Rubinius</title>
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content='ru' http-equiv='content-language'>
    <meta content='Rubinius is an implementation of the Ruby programming language. The Rubinius bytecode virtual machine is written in C++. The bytecode compiler is written in pure Ruby. The vast majority of the core library is also written in Ruby, with some supporting primitives that interact with the VM directly.' name='description'>
    <link href='/' rel='home'>
    <link href='/' rel='start'>
    <link href='/doc/ru/systems/ffi' rel='prev' title='FFI'>
    <link href='/doc/ru/systems/io'         rel='next' title='Ввод/Вывод'>
    
    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->

    <link href="/stylesheets/application.css" media="screen" rel="stylesheet" />
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" />

    <link href="/favicon.ico"                 rel="shortcut icon"    type="image/vnd.microsoft.icon" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="72x72"   />
    <link href="/images/apple-touch-icon.png" rel="apple-touch-icon" type="image/png" sizes="114x114" />
  </head>

  <body>
    <nav id="sidebar">
  <div class="sidebar-header">
    <a href="#" class="logo">Rubinius</a>
    <div role="search">
      <input type="text" name="q" placeholder="Search docs">
    </div>
  </div>

  <div class="sidebar-nav">
    <ul>
      <li><a href="/doc/en/what-is-rubinius/">What is Rubinius?</a> </li> 
      <li><a href="/doc/en/getting-started/">Getting Started</a>
        <ul>
          <li><a href="/doc/en/getting-started/requirements/">Requirements</a> </li>
          <li><a href="/doc/en/getting-started/building/">Building</a> </li>
          <li><a href="/doc/en/getting-started/running-rubinius/">Running Rubinius</a> </li>
          <li><a href="/doc/en/getting-started/troubleshooting/">Troubleshooting</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/contributing/">Contributing</a>
        <ul>
          <li><a href="/doc/en/contributing/communication/">Communication</a> </li>
          <li><a href="/doc/en/contributing/style-guide">Style Guide</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/ruby/">Ruby</a>
        <ul>
          <li><a href="/doc/en/ruby/scripts/">Scripts</a> </li>
          <li><a href="/doc/en/ruby/methods/">Methods</a> </li>
          <li><a href="/doc/en/ruby/constants/">Constants</a> </li>
          <li><a href="/doc/en/ruby/classes-and-modules/">Classes &amp; Modules</a> </li>
          <li><a href="/doc/en/ruby/blocks-and-procs/">Blocks &amp; Procs</a> </li>
          <li><a href="/doc/en/ruby/local-variables/">Local Variables</a> </li>
          <li><a href="/doc/en/ruby/instance-variables/">Instance Variables</a> </li>
          <li><a href="/doc/en/ruby/class-variables/">Class Variables</a> </li>
          <li><a href="/doc/en/ruby/global-variables/">Global Variables</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/specs/">Specs</a>
        <ul>
          <li><a href="/doc/en/specs/rubyspec/">RubySpec</a> </li> 
          <li><a href="/doc/en/specs/compiler/">Compiler Specs</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/build-system/">Build System</a> </li>
      <li><a href="/doc/en/bootstrapping/">Bootstrapping</a> </li>
      <li><a href="/doc/en/virtual-machine/">Virtual Machine</a> 
        <ul>
          <li><a href="/doc/en/virtual-machine/instructions/">Instructions</a> </li>
          <li><a href="/doc/en/virtual-machine/custom-dispatch-logic/">Custom Dispatch Logic</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/bytecode-compiler/">Bytecode Compiler</a>
        <ul>
          <li><a href="/doc/en/bytecode-compiler/parser/">Parser Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/ast/">AST</a> </li>
          <li><a href="/doc/en/bytecode-compiler/generator/">Generator Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/encoder/">Encoder Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/packager/">Packager Stage</a> </li>
          <li><a href="/doc/en/bytecode-compiler/writer/">Writer Stage</a> </li>
          <li>Printers</li>
          <li><a href="/doc/en/bytecode-compiler/transformations/">Transformations</a> </li>
          <li><a href="/doc/en/bytecode-compiler/customization/">Customizing the Pipeline</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/jit/">JIT Compiler</a> </li>
      <li><a href="/doc/en/memory-system/">Memory system</a> 
        <ul>
          <li><a href="/doc/en/memory-system/object-layout/">Object layout</a> </li>
          <li><a href="/doc/en/memory-system/garbage-collector/">Garbage collector</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/systems/">Rubinius Systems</a>
        <ul>
          <li><a href="/doc/en/systems/primitives/">Primitives</a> </li>
          <li><a href="/doc/en/systems/ffi/">FFI</a> </li>
          <li><a href="/doc/en/systems/concurrency/">Concurrency</a> </li>
          <li><a href="/doc/en/systems/io/">IO</a> </li>
          <li><a href="/doc/en/systems/c-api/">C-API</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/tools/">Tools</a>
        <ul>
          <li><a href="/doc/en/tools/debugger/">Debugger</a> </li>
          <li><a href="/doc/en/tools/profiler/">Profiler</a> </li>
          <li><a href="/doc/en/tools/memory-analysis/">Memory Analysis</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/guides/">Guides</a>
        <ul>
          <li><a href="/doc/en/guides/migrating-from-mri-to-rubinius/">Migrating from MRI to Rubinius</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/how-to/">How-To</a>
        <ul>
          <li><a href="/doc/en/how-to/write-a-ticket/">Write a Ticket</a> </li>
          <li><a href="/doc/en/how-to/write-a-ruby-spec/">Write a Ruby Spec</a> </li>
          <li><a href="/doc/en/how-to/fix-a-failing-spec/">Fix a Failing Spec</a> </li>
          <li><a href="/doc/en/how-to/write-benchmarks/">Write Benchmarks</a> </li>
          <li><a href="/doc/en/how-to/write-a-blog-post/">Write a Blog Post</a> </li>
          <li><a href="/doc/en/how-to/write-documentation/">Write Documentation</a> </li>
          <li><a href="/doc/en/how-to/translate-documentation/">Translate Documentation</a> </li>
          <li><a href="/doc/en/how-to/commit-to-github/">Commit to Github</a> </li>
        </ul>
      </li>
      <li><a href="/doc/en/appendix-a-glossary/">Appendix A - Glossary</a> </li>
      <li><a href="/doc/en/appendix-b-reading-list/">Appendix B - Reading List</a> </li>
      <li><a href="/doc/en/index-of-terms/">Index of Terms</a> </li>
      <li><a href="/doc/en/frequently-asked-questions/">Frequently Asked Questions</a> </li>
    </ul>
  </div>

  <div class="sidebar-footer">
    <ul>
  
  
  
  <li><a href="/doc/de/systems/concurrency/"
    
    >de</a></li>
  
  
  
  <li><a href="/doc/en/systems/concurrency/"
    
    >en</a></li>
  
  
  
  <li><a href="/doc/es/systems/concurrency/"
    
    >es</a></li>
  
  
  
  <li><a href="/doc/fr/systems/concurrency/"
    
    >fr</a></li>
  
  
  
  <li><a href="/doc/it/systems/concurrency/"
    
    >it</a></li>
  
  
  
  <li><a href="/doc/ja/systems/concurrency/"
    
    >ja</a></li>
  
  
  
  <li><a href="/doc/pl/systems/concurrency/"
    
    >pl</a></li>
  
  
  
  <li><a href="/doc/pt-br/systems/concurrency/"
    
    >pt-br</a></li>
  
  
  
  <li><a href="/doc/ru/systems/concurrency/"
    
    class="current"
    
    >ru</a></li>
  
</ul>

    <div class="social">
      <div class="icons">
        <a href="http://twitter.com/rubinius" class="twitter">@rubinius</a>
        <a href="http://github.com/rubinius" class="github">github</a>
      </div>
      <div class="version">
        <a href="https://github.com/rubinius/rubinius/releases/tag/v2.2.10">v2.2.10</a>
      </div>
    </div>
  </div>
</nav>


<div class="container documentation">
  <h2>Параллелизм</h2>

  

  

    <p>Для обеспечения параллелизма Rubinius поддерживает те же базовые конструкции,
что и MRI Ruby: <code>Treads</code> и <code>Fibers</code>. Создан также и новый API, для реализации
<strong>акторов</strong>: <code>Actors</code>. Акторы обеспечивают параллелизм без участия мутексов и
блокировок в передаче статуса между тредами.</p>

<p>Акторы выполняются параллельно, но не имеют общего статуса. Вместо этого они
передают другим акторам сообщения. В качестве примера создадим два актора
при помощи <code>Actor.spawn</code>: <code>ping</code> и <code>pong</code>. Пусть они обмениваются сообщениями
до тех пор, пока совместно не произведут инкремент переменной до 1000:</p>

<pre><code>require 'actor'
pong = nil
ping = Actor.spawn do
  loop do
    count = Actor.receive
    break puts(count) if count &gt; 1000
    pong &lt;&lt; (count + 1)
  end
end
pong = Actor.spawn do
  loop do
    count = Actor.receive
    break puts(count) if count &gt; 1000
    ping &lt;&lt; (count + 1)
  end
end
ping &lt;&lt; 1
sleep 1
</code></pre>

<p>Обратите внимание: акторы принимают сообщения посредством <code>Actor.receive</code>.
Этот вызов блокирует актор до тех пор, пока сообщение не придет в его
&lt;&lt;почтовый ящик>>. Передавая <code>Actor.receive</code> блок и используя фильтрацию
сообщений, можно учитывать в алгоритме тип сообщения:</p>

<pre><code>Actor.receive do |filter|
  filter.when(Ready) do |who|
    # SNIP
  end
  filter.when(Work) do |work|
    ready_workers.pop &lt;&lt; work
  end
  filter.when(Actor::DeadActorError) do |exit|
    print "Actor exited with message: #{exit.reason}\n"
    ready_workers &lt;&lt; Actor.spawn_link(&amp;work_loop)
  end
end
</code></pre>

<p>Фильтры применяют к сообщениям метод <code>===</code>, поэтому <code>when()</code> можно
передавать, например, регулярные выражения, классы или процедуры --- в
зависимости от конкретной ситуации.</p>

<p>Акторы могут приобретать отношения &lt;&lt;предок-потомок>> посредством
<code>Actor.spawn_link</code>. Если потомок по какой-то причине &lt;&lt;умирает>>,
актор-родитель может получить об этом извещение, если перед запуском потомка
переменная <code>Actor.trap_exit</code> была установлена в <code>true</code>. Создадим
актор-супервизор, управляющий некоторой очередью при помощи 10
акторов-работников, выполняющих непосредственный процессинг очереди. Если
работник умирает (т.е. инициирует исключение), супервизор получает сообщение
<code>Actor::DeadActorError</code>.</p>

<pre><code>require 'actor'

Ready = Struct.new(:this)
Work = Struct.new(:msg)

@supervisor = Actor.spawn do
  supervisor = Actor.current
  work_loop = Proc.new do
    loop do
      work = Actor.receive
      puts("Processing: #{work.msg}")
      supervisor &lt;&lt; Ready[Actor.current]
    end
  end

  Actor.trap_exit = true
  ready_workers = []
  10.times do |x|
    # start 10 worker actors
    ready_workers &lt;&lt; Actor.spawn_link(&amp;work_loop)
  end
  loop do
    Actor.receive do |f|
      f.when(Ready) do |who|
        # SNIP
      end
      f.when(Work) do |work|
        ready_workers.pop &lt;&lt; work
      end
      f.when(Actor::DeadActorError) do |exit|
        print "Actor exited with message: #{exit.reason}\n"
        ready_workers &lt;&lt; Actor.spawn_link(&amp;work_loop)
      end
    end
  end
end

10.times do |idx|
  @supervisor &lt;&lt; Work[idx]
end
sleep 1
</code></pre>

<p>Приведенный пример --- фрагмент кода из
<a href="https://github.com/mperham/girl_friday">&lt;<girl_friday>></a>. Если у Вас возникли
вопросы, поизучайте этот проект.</p>


</div>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="/javascripts/jquery-1.3.2.js"></script>
    <script src="/javascripts/paging_keys.js"></script>
    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
